\doxysection{S7\+Mothership.\+hpp}
\hypertarget{S7Mothership_8hpp_source}{}\label{S7Mothership_8hpp_source}\index{include/s7\_mothership\_v0\_1\_0/S7Mothership.hpp@{include/s7\_mothership\_v0\_1\_0/S7Mothership.hpp}}
\mbox{\hyperlink{S7Mothership_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}drdc.h"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}rclcpp/rclcpp.hpp"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}geometry\_msgs/msg/pose\_stamped.hpp"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}geometry\_msgs/msg/wrench\_stamped.hpp"{}}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#pragma\ region\ subclasses\ \&\ enums}}
\DoxyCodeLine{00015\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268}{S7Mode}}}
\DoxyCodeLine{00016\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268abe82b18b704441fcf2c92bd7c84a4eb3}{BRAKING}},}
\DoxyCodeLine{00018\ \ \ \ \ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268acc62d1576546f3245237e1b232d838b6}{FREE}},}
\DoxyCodeLine{00019\ \ \ \ \ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268ab2e2006ed086024f6e3c3c3e99ff198d}{SELF\_CENTERING}}}
\DoxyCodeLine{00020\ \};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classS7StatePublisher}{S7StatePublisher}}\ :\ \textcolor{keyword}{public}\ rclcpp::Node}
\DoxyCodeLine{00029\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00034\ \ \ \ \ rclcpp::Publisher<geometry\_msgs::msg::PoseStamped>::SharedPtr\ \mbox{\hyperlink{classS7StatePublisher_ac8c97b8e5455a50e360fec5c2119134d}{publisher\_}};}
\DoxyCodeLine{00038\ \ \ \ \ geometry\_msgs::msg::PoseStamped::SharedPtr\ \mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classS7StatePublisher_a5c571d8298835ea09341c16f8981fb1e}{S7StatePublisher}}()\ :\ Node(\textcolor{stringliteral}{"{}state\_publisher"{}})}
\DoxyCodeLine{00049\ \ \ \ \ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7StatePublisher_ac8c97b8e5455a50e360fec5c2119134d}{publisher\_}}\ =\ this-\/>create\_publisher<geometry\_msgs::msg::PoseStamped>(\textcolor{stringliteral}{"{}controller\_pose\_stamped"{}},\ 1);}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00056\ \ \ \ \ geometry\_msgs::msg::PoseStamped::SharedPtr\ \mbox{\hyperlink{classS7StatePublisher_a37b2b2db3d583323417e3abbf35d2dab}{getCurrentState}}()}
\DoxyCodeLine{00057\ \ \ \ \ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}})}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}};}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_WARN(get\_logger(),\ \textcolor{stringliteral}{"{}current\_state\_\ is\ null\ when\ getting"{}});}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classS7StatePublisher_a65868bd6ca5616664c1a50a3650bb612}{setCurrentState}}(geometry\_msgs::msg::PoseStamped::SharedPtr\ state)\ \{\ \mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}}\ =\ state;\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00081\ \ \ \ \ int8\_t\ \mbox{\hyperlink{classS7StatePublisher_a8cc60f5c9a91d8ceb72e17e9554aed3d}{publish}}()}
\DoxyCodeLine{00082\ \ \ \ \ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}})}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7StatePublisher_ac8c97b8e5455a50e360fec5c2119134d}{publisher\_}}-\/>publish(*\mbox{\hyperlink{classS7StatePublisher_a13fcdf3e01c39e1e033c7af4663af622}{current\_state\_}});}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \};}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classS7ForceSubscriber}{S7ForceSubscriber}}\ :\ \textcolor{keyword}{public}\ rclcpp::Node}
\DoxyCodeLine{00102\ \{}
\DoxyCodeLine{00103\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00107\ \ \ \ \ rclcpp::Subscription<geometry\_msgs::msg::WrenchStamped>::SharedPtr\ \mbox{\hyperlink{classS7ForceSubscriber_a7c9c2b8ee2b30e15faeb33d47c907789}{subscriber\_}};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00112\ \ \ \ \ geometry\_msgs::msg::WrenchStamped::SharedPtr\ \mbox{\hyperlink{classS7ForceSubscriber_a7175a56059119e0a00a698297d3ee634}{current\_wrench\_}};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{classS7ForceSubscriber_a862f3915bd58bf99917ea4dcf705da0c}{S7ForceSubscriber}}()\ :\ Node(\textcolor{stringliteral}{"{}wrench\_subscriber"{}})}
\DoxyCodeLine{00124\ \ \ \ \ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7ForceSubscriber_a7c9c2b8ee2b30e15faeb33d47c907789}{subscriber\_}}\ =\ this-\/>create\_subscription<geometry\_msgs::msg::WrenchStamped>(}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}controller\_wrench\_stamped"{}},\ 1,}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ std::bind(\&\mbox{\hyperlink{classS7ForceSubscriber_ae7fa069366cb48446e3a592a768e4e65}{S7ForceSubscriber::messageCallback}},\ \textcolor{keyword}{this},\ std::placeholders::\_1));}
\DoxyCodeLine{00128\ \ \ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00135\ \ \ \ \ geometry\_msgs::msg::WrenchStamped::SharedPtr\ \mbox{\hyperlink{classS7ForceSubscriber_a014885d6402d4b13ba7a3d7ec0f85103}{getCurrentWrench}}()}
\DoxyCodeLine{00136\ \ \ \ \ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classS7ForceSubscriber_a7175a56059119e0a00a698297d3ee634}{current\_wrench\_}})}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classS7ForceSubscriber_a7175a56059119e0a00a698297d3ee634}{current\_wrench\_}};}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_WARN(get\_logger(),\ \textcolor{stringliteral}{"{}current\_wrench\_\ null\ when\ getting"{}});}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classS7ForceSubscriber_a7175a56059119e0a00a698297d3ee634}{current\_wrench\_}};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classS7ForceSubscriber_ab64133dbf94f465e322171483a252e10}{setCurrentWrench}}(geometry\_msgs::msg::WrenchStamped::SharedPtr\ wrench)\ \{\ \mbox{\hyperlink{classS7ForceSubscriber_a7175a56059119e0a00a698297d3ee634}{current\_wrench\_}}\ =\ wrench;\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classS7ForceSubscriber_ae7fa069366cb48446e3a592a768e4e65}{messageCallback}}(\textcolor{keyword}{const}\ geometry\_msgs::msg::WrenchStamped::SharedPtr\ message)}
\DoxyCodeLine{00159\ \ \ \ \ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (message)}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7ForceSubscriber_ab64133dbf94f465e322171483a252e10}{setCurrentWrench}}(message);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_WARN(get\_logger(),\ \textcolor{stringliteral}{"{}message\ in\ S7ForceSubscriber\ is\ null\ when\ setting\ current\_wrench\_"{}});}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7ForceSubscriber_ab64133dbf94f465e322171483a252e10}{setCurrentWrench}}(message);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00169\ \ \ \ \ \}}
\DoxyCodeLine{00170\ \};}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00175\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classS7InterfaceControlPublisher}{S7InterfaceControlPublisher}}\ :\ \textcolor{keyword}{public}\ rclcpp::Node}
\DoxyCodeLine{00176\ \{}
\DoxyCodeLine{00177\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classS7InterfaceControlPublisher_a426cc97fad1306b3104c834a91387df4}{S7InterfaceControlPublisher}}()\ :\ Node(\textcolor{stringliteral}{"{}state\_publisher"{}})\ \{\}}
\DoxyCodeLine{00179\ \};}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00184\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classS7InterfaceControlsubscriber}{S7InterfaceControlsubscriber}}\ :\ \textcolor{keyword}{public}\ rclcpp::Node}
\DoxyCodeLine{00185\ \{}
\DoxyCodeLine{00186\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{classS7InterfaceControlsubscriber_a13692eb41f306c8087b66d435085b018}{S7InterfaceControlsubscriber}}()\ :\ Node(\textcolor{stringliteral}{"{}state\_publisher"{}})\ \{\}}
\DoxyCodeLine{00188\ \};}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00196\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classS7Controller}{S7Controller}}\ \textcolor{comment}{//:\ public\ rclcpp::node}}
\DoxyCodeLine{00197\ \{}
\DoxyCodeLine{00198\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classS7Controller_a5fe32fca238c9a1dfd64fea6c6c1ba98}{positionCenter}}[DHD\_MAX\_DOF]\ =\ \{\};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268}{S7Mode}}\ \mbox{\hyperlink{classS7Controller_a11338b5c2739023374ba7464fb55628e}{current\_mode\_}};}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classS7Controller_a798c7ffbc1f8cd374b387a7617d6de36}{running\_}};}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{classS7Controller_a4f0d2dee2ec33ce54fcd0c2cf28d1d1d}{S7Controller}}()\ \{\}}
\DoxyCodeLine{00219\ \ \ \ \ }
\DoxyCodeLine{00223\ \ \ \ \ \mbox{\hyperlink{classS7Controller_a497cff26298873976b5c8b4685cfe0f0}{\string~S7Controller}}()}
\DoxyCodeLine{00224\ \ \ \ \ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7Controller_a7c5f27eb50c0188bdd25cfe0cfe24f67}{stop}}();}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classS7Controller_a1fe38897931c5808a6a69fa4155bd16b}{run}}()}
\DoxyCodeLine{00232\ \ \ \ \ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classS7Controller_a798c7ffbc1f8cd374b387a7617d6de36}{running\_}})}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7Controller_ab79ddf306c0b00f799fb74a5c16470ef}{loop}}();}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7Controller_a798c7ffbc1f8cd374b387a7617d6de36}{running\_}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classS7Controller_a7c5f27eb50c0188bdd25cfe0cfe24f67}{stop}}()}
\DoxyCodeLine{00249\ \ \ \ \ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classS7Controller_a798c7ffbc1f8cd374b387a7617d6de36}{running\_}})}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classS7Controller_a798c7ffbc1f8cd374b387a7617d6de36}{running\_}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00259\ \ \ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classS7Controller_ab79ddf306c0b00f799fb74a5c16470ef}{loop}}()}
\DoxyCodeLine{00269\ \ \ \ \ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ namespace\ }std::chrono;}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ period\ =\ microseconds(2000);}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classS7Controller_ae5aeda63056ac4f2410350db8d397c6a}{hapticInit}}())}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}failed\ to\ initialize\ Sigma7,\ make\ sure"{}}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}device\ is\ on\ and\ connected,\ and\ Mothership"{}}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}is\ launched\ with\ root\ privileges."{}});}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{classS7Controller_a798c7ffbc1f8cd374b387a7617d6de36}{running\_}})}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ start\ =\ steady\_clock::now();}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO,\ data\ aquisition}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO,\ control\ section}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ elapsed\ =\ steady\_clock::now()\ -\/\ start;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (elapsed\ <\ period)}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::this\_thread::sleep\_for(period\ -\/\ elapsed);}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ overrun\ =\ duration\_cast<microseconds>(elapsed\ -\/\ period).count();}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_WARN(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}main\ control\ loop\ too\ slow\ by\ \%ld\ microseconds."{}},\ overrun);}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Close\ the\ connection\ to\ the\ haptic\ device.}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (drdClose()\ <\ 0)}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}error:\ failed\ to\ close\ the\ connection\ (\%s)"{}},\ dhdErrorGetLastStr());}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ dhdSleep(2.0);}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}connexion\ closed.\(\backslash\)n"{}});}
\DoxyCodeLine{00310\ \ \ \ \ \}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classS7Controller_ae5aeda63056ac4f2410350db8d397c6a}{hapticInit}}()}
\DoxyCodeLine{00317\ \ \ \ \ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((drdOpen()\ <\ 0))}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}error:\ failed\ to\ open\ device\ (\%s)"{}},\ dhdErrorGetLastStr());}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ dhdSleep(2.0);}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}\%s\ device\ detected.\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}WARNING,\ do\ NOT\ touch\ Sigma7\ during\ caibration.\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dhdGetSystemName());}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((drdCheckInit()\ <\ 0))}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}error:\ failed\ to\ reinitialize\ device\ (\%s)"{}},\ dhdErrorGetLastStr());}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ dhdSleep(2.0);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}moving\ to\ :"{}});}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ DHD\_MAX\_DOF;\ ++i)}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_INFO(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}\%f"{}},\ \mbox{\hyperlink{classS7Controller_a5fe32fca238c9a1dfd64fea6c6c1ba98}{positionCenter}}[i]);}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (drdMoveTo(\mbox{\hyperlink{classS7Controller_a5fe32fca238c9a1dfd64fea6c6c1ba98}{positionCenter}})\ <\ 0)}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}error:\ failed\ to\ move\ device\ (\%s)"{}},\ dhdErrorGetLastStr());}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ dhdSleep(2.0);}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ the\ regulation\ thread\ but\ leaves\ the\ forces\ enabled\ on\ the\ device.}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (drdStop(\textcolor{keyword}{true})\ <\ 0)}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ RCLCPP\_ERROR(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}error:\ failed\ to\ stop\ robotic\ regulation\ device\ (\%s)"{}},\ dhdErrorGetLastStr());}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ dhdSleep(2.0);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ RCLCPP\_INFO(rclcpp::get\_logger(\textcolor{stringliteral}{"{}S7Controller"{}}),\ \textcolor{stringliteral}{"{}Successfully\ initialised\ device\ :\ \%s"{}},\ dhdGetSystemName());}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00356\ \ \ \ \ \}}
\DoxyCodeLine{00357\ \};}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \textcolor{preprocessor}{\#pragma\ endregion}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classS7Mothership}{S7Mothership}}\ :\ \textcolor{keyword}{public}\ rclcpp::Node}
\DoxyCodeLine{00362\ \{}
\DoxyCodeLine{00363\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//\ member\ objects}}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{classS7StatePublisher}{S7StatePublisher}}\ \mbox{\hyperlink{classS7Mothership_a526daa1c3cd236d2cfd0ac4978db44bd}{StatePublisher\_}};}
\DoxyCodeLine{00366\ \ \ \ \ \mbox{\hyperlink{classS7ForceSubscriber}{S7ForceSubscriber}}\ \mbox{\hyperlink{classS7Mothership_a24b7828ba6d4bea0c3585db51031e5d0}{ForceSubscriber\_}};}
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{classS7Controller}{S7Controller}}\ \mbox{\hyperlink{classS7Mothership_aebad93d86b015e8df929892e2afb51a7}{Controller\_}};}
\DoxyCodeLine{00368\ \ \ \ \ \mbox{\hyperlink{classS7InterfaceControlPublisher}{S7InterfaceControlPublisher}}\ \mbox{\hyperlink{classS7Mothership_a82b04b548f918642cb31b8a2a301381f}{ControlPublisher\_}};}
\DoxyCodeLine{00369\ \ \ \ \ \mbox{\hyperlink{classS7InterfaceControlsubscriber}{S7InterfaceControlsubscriber}}\ \mbox{\hyperlink{classS7Mothership_af7223657431eba328093a50ae616824f}{ControlSubscriber\_}};}
\DoxyCodeLine{00370\ \ \ \ \ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268}{S7Mode}}\ \mbox{\hyperlink{classS7Mothership_a9b833997523257dbda6cee451734fe20}{CurrentMode\_}};}
\DoxyCodeLine{00371\ \ \ \ \ \mbox{\hyperlink{S7Mothership_8hpp_a743191de3e8394b54fb8ba0c1dffa268}{S7Mode}}\ \mbox{\hyperlink{classS7Mothership_a43cb86e63e7795730d8e0c2cdf324fbd}{RequestedMode\_}};}
\DoxyCodeLine{00372\ \};}

\end{DoxyCode}
